ComfyUI 插件开发需求文档
一、功能描述（一）图片反推提示词保存功能用户在使用 ComfyUI 进行图片反推操作后，能够将反推出来的提示词直接保存到指定的 txt 文档中，或者自动创建 txt 文档进行保存。在进行批量反推时，用户可以选择为每张图片分别创建 txt 文档保存提示词，或者将所有提示词汇总到同一个 txt 文档中，以便形成 wildcards 文件供后续文生图使用。
（二）随机提示词抽取功能在加载 wildcards 文件生成图片时，能够真正随机抽取文件中的提示词进行图片生成，而不是从第一个提示词开始依次生成。用户可以在加载 wildcards 文件后，通过一个节点或选项设置随机抽取提示词的功能，每次生图时随机抽取一组提示词生成图片。
二、操作流程（一）
图片反推提示词保存操作流程1. 单张图片反推提示词保存用户完成图片反推操作后，点击界面中的“保存提示词”按钮。弹出文件保存对话框，用户选择目标文件夹和文件名（如果已指定默认路径和文件名，可直接使用）。点击“保存”，提示词被写入对应的 txt 文档。如果目标文档不存在，则自动创建该文档。2. 批量图片反推提示词保存用户启动批量反推操作，在批量处理设置界面中，点击“保存提示词选项”区域。在该区域中，选择保存方式：“为每张图片创建单独 txt 文档”或“汇总到同一 txt 文档”。如果选择“为每张图片创建单独 txt 文档”，指定目标文件夹，系统将根据图片名称（或用户自定义命名规则）为每张图片生成对应的 txt 文件，并将提示词写入。如果选择“汇总到同一 txt 文档”，指定目标文件夹和文件名，系统将所有图片的提示词按一定格式（如每张图片的提示词占一行，或用特定分隔符区分）汇总到该文档中。
（二）随机提示词抽取操作流程1. 用户加载 wildcards 文件后，在操作界面中找到“随机抽取提示词”节点或选项。2. 在该节点或选项中，设置相关参数（如是否启用随机抽取、抽取数量等）。3. 执行生图操作时，系统根据设置随机抽取指定数量的提示词进行图片生成。
三、技术要求（一）兼容性1. 插件应与 ComfyUI 现有插件环境兼容，避免与 ComfyUI 的核心功能和其他常用插件（如图片反推插件、随机提示词插件等）发生冲突。2. 插件应支持 ComfyUI 的主流版本（如 1.x、2.x 等），确保在不同版本中都能正常运行。
（二）性能1. 在执行图片反推提示词保存操作时，响应速度快，即使在批量处理大量图片时，也能在合理的时间内完成保存任务。2. 随机提示词抽取功能在生成图片时，随机抽取过程快速且准确，不影响整体生图速度和质量。
四、界面设计（一）图片反推提示词保存界面设计1. 在图片反推操作界面中，添加一个“保存提示词”按钮，位置在反推操作完成提示区域附近。2. 在批量反推设置界面中，添加一个“保存提示词选项”区域，包含单选按钮让用户选择保存方式（“为每张图片创建单独 txt 文档”或“汇总到同一 txt 文档”），以及文件路径和文件名输入框。
（二）随机提示词抽取界面设计1. 在加载 wildcards 文件后的操作界面中，添加一个“随机抽取提示词”节点或选项。2. 该节点或选项包含启用开关、抽取数量输入框等参数设置控件，方便用户配置随机抽取功能。
五、其他要求（一）错误处理1. 在保存提示词或随机抽取提示词过程中，若出现文件路径错误、磁盘空间不足、文件格式不兼容等异常情况，能够及时提示用户错误信息，并给出相应的解决建议。2. 如果在操作过程中出现程序崩溃或数据丢失的情况，能够提供恢复或备份机制。
（二）使用说明1. 提供详细的插件使用说明文档，包括功能介绍、操作步骤、参数设置说明等内容，方便用户快速掌握插件的使用方法。2. 在插件的用户界面中，添加必要的提示信息和帮助按钮，引导用户正确使用插件。希望 Trae AI 编程应用能够根据以上需求，开发出满足我使用 ComfyUI 时的图片反推提示词保存和随机提示词抽取功能的插件。