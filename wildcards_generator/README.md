# ComfyUI Wildcards Generator 插件

## 功能描述

该插件为 ComfyUI 提供了两个核心功能：

### 1. 图片反推提示词保存功能
- 单张图片反推提示词保存：将反推出来的提示词保存到指定的 txt 文档中
- 批量图片反推提示词保存：
  - 为每张图片创建单独的 txt 文档保存提示词
  - 将所有提示词汇总到同一个 txt 文档中，形成 wildcards 文件

### 2. 随机提示词抽取功能
- 从 wildcards 文件中随机抽取提示词进行图片生成
- 支持设置随机种子，确保结果可复现
- 支持一次抽取多个提示词

## 安装方法

1. 将 `wildcards_generator` 文件夹复制到 ComfyUI 的 `custom_nodes` 目录下
2. 重启 ComfyUI
3. 在节点列表中找到 `wildcards_generator` 类别，即可使用相关节点

## 使用说明

### 1. 保存反推提示词节点 (PromptSaveNode)

**输入参数：**
- `prompt`：要保存的提示词内容
- `save_path`：保存文件的目标路径
- `file_name`：保存的文件名（仅在 single_file 模式下有效）
- `save_mode`：保存模式
  - `single_file`：将所有提示词保存到同一个文件中
  - `multiple_files`：为每张图片创建单独的文件
- `image_name`：图片名称（仅在 multiple_files 模式下有效）
- `image`：可选，图片输入

**输出：**
- 界面显示保存结果信息

### 2. 随机抽取提示词节点 (RandomWildcardNode)

**输入参数：**
- `wildcard_file`：wildcards 文件路径
- `num_prompts`：要抽取的提示词数量
- `seed`：随机种子（0 表示使用随机种子）

**输出：**
- `random_prompt`：随机抽取的提示词

## 操作流程

### 1. 单张图片反推提示词保存
1. 在 ComfyUI 中完成图片反推操作
2. 将反推得到的提示词连接到 `保存反推提示词` 节点的 `prompt` 输入
3. 设置保存路径和文件名
4. 执行节点，提示词将被保存到指定文件

### 2. 批量图片反推提示词保存
1. 在 ComfyUI 中设置批量反推操作
2. 将反推得到的提示词连接到 `保存反推提示词` 节点的 `prompt` 输入
3. 在 `save_mode` 中选择 `multiple_files`
4. 设置保存路径和图片名称（可通过其他节点动态生成）
5. 执行批量操作，每张图片的提示词将被保存到单独的文件

### 3. 随机提示词抽取
1. 创建一个包含多个提示词的 wildcards.txt 文件（每行一个提示词）
2. 添加 `随机抽取提示词` 节点
3. 设置 wildcards 文件路径和要抽取的提示词数量
4. 将节点输出连接到文生图节点的提示词输入
5. 执行生图操作，每次将随机抽取提示词生成图片

## 示例工作流

### 示例 1：单张图片反推保存
```
图片反推节点 → 保存反推提示词节点 → 输出保存结果
```

### 示例 2：批量图片反推保存
```
批量图片输入 → 图片反推节点 → 保存反推提示词节点（multiple_files 模式） → 输出保存结果
```

### 示例 3：随机提示词生成图片
```
随机抽取提示词节点 → 文生图节点 → 图片输出
```

## 注意事项

1. 确保保存路径存在或具有写入权限
2. 批量处理时，建议使用有意义的图片名称，以便生成的提示词文件易于管理
3. 使用随机种子可以确保生成结果可复现
4. wildcards 文件格式：每行一个提示词，空行将被忽略

## 更新日志

### v1.0.0
- 初始版本
- 实现图片反推提示词保存功能
- 实现随机提示词抽取功能
